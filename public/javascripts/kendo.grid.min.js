(function(a,b){function F(a){return Array(a+1).join('<td class="k-group-cell"></td>')}var c=window.kendo,d=c.ui,e=c.data.DataSource,f=c.ui.Groupable,g=c.support.tbodyInnerHtml,h=d.Component,i=c.keys,j=a.isPlainObject,k=a.extend,l=a.map,m=a.isArray,n=a.proxy,o=Math,p="requestStart",q="error",r="tbody>tr:not(.k-grouping-row):visible",s=r+">td:not(.k-group-cell)",t=s+":first",u="change",v="dataBound",w="k-state-focused",x="k-focusable",y="k-state-selected",z="click",A="height",B="tabIndex",C="function",D="string",E=h.extend({init:function(a,b){var c=this;h.fn.init.call(c,a,b),c.dataSource=b.dataSource,c.dataSource.bind(u,n(c.refresh,c)),c.wrap()},options:{itemHeight:a.noop},wrap:function(){var b=this,d=c.support.scrollbar()+1,e=b.element;e.css({width:"auto",paddingRight:d,overflow:"hidden"}),b.content=e.children().first(),b.wrapper=b.content.wrap('<div class="k-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll",n(b._wheelScroll,b)).bind("mousewheel",n(b._wheelScroll,b)),b.verticalScrollbar=a('<div class="k-scrollbar k-scrollbar-vertical" />').css({width:d}).appendTo(e).bind("scroll",n(b._scroll,b))},_wheelScroll:function(b){var c=this,d=c.verticalScrollbar.scrollTop(),e=b.originalEvent,f;b.preventDefault(),e.wheelDelta?f=e.wheelDelta:e.detail?f=-e.detail:a.browser.opera&&(f=-e.wheelDelta),c.verticalScrollbar.scrollTop(d+ -f)},_scroll:function(a){var b=this,c=a.currentTarget.scrollTop,d=b.dataSource,e=b.itemHeight,f=d.skip()||0,g=b._rangeStart||f,h=b.element.innerHeight(),i=!!(b._scrollbarTop&&b._scrollbarTop>c),j=o.max(o.floor(c/e),0),k=o.max(j+o.floor(h/e),0);b._scrollTop=c-g*e,b._scrollbarTop=c,b._fetch(j,k,i)||(b.wrapper[0].scrollTop=b._scrollTop)},_fetch:function(a,b,c){var d=this,e=d.dataSource,f=d.itemHeight,g=e.take(),h=d._rangeStart||e.skip()||0,i=o.floor(a/g)*g,j=!1,k=.33;a<h?(j=!0,h=o.max(0,b-g),d._scrollTop=(a-h)*f,d._page(h,g)):b>=h+g&&!c?(j=!0,h=a,d._scrollTop=f,d._page(h,g)):d._fetching||(a<i+g-g*k&&a>g&&e.prefetch(i-g,g),b>i+g*k&&e.prefetch(i+g,g));return j},_page:function(a,b){var d=this,e=d.dataSource;clearTimeout(d._timeout),d._fetching=!0,d._rangeStart=a,e.inRange(a,b)?e.range(a,b):(c.ui.progress(d.wrapper,!0),d._timeout=setTimeout(function(){e.range(a,b)},100))},refresh:function(){var a=this,b="",d=25e4,e=a.dataSource,f=a._rangeStart,g;c.ui.progress(a.wrapper,!1),clearTimeout(a._timeout),g=a.itemHeight=a.options.itemHeight()||0,totalHeight=e.total()*g;for(idx=0;idx<o.round(totalHeight/d);idx++)b+='<div style="width:1px;height:'+d+'px"></div>';totalHeight%d&&(b+='<div style="width:1px;height:'+totalHeight%d+'px"></div>'),a.verticalScrollbar.html(b),a.wrapper[0].scrollTop=a._scrollTop,f&&!a._fetching&&(a._rangeStart=e.skip()),a._fetching=!1}}),G=h.extend({init:function(a,b){var c=this;b=m(b)?{dataSource:b}:b,h.fn.init.call(c,a,b),c._element(),c._columns(c.options.columns),c._dataSource(),c._tbody(),c._pageable(),c._groupable(),c._thead(),c._templates(),c._navigatable(),c._selectable(),c.bind([u,v],c.options),c.options.autoBind&&c.dataSource.query()},options:{columns:[],autoBind:!0,scrollable:!0,groupable:!1,dataSource:{}},_element:function(){var b=this,c=b.element;c.is("table")||(c=a("<table />").appendTo(b.element)),b.table=c.attr("cellspacing",0),b._wrapper()},_groupable:function(){var b=this,c=b.wrapper,d=b.options.groupable;d&&(c.has("div.k-grouping-header")[0]||a("<div />").addClass("k-grouping-header").prependTo(c),b.groupable=new f(c,{filter:"th:not(.k-group-cell)",groupContainer:"div.k-grouping-header",dataSource:b.dataSource})),b.table.delegate(".k-grouping-row .k-collapse, .k-grouping-row .k-expand",z,function(c){var d=a(this),e=d.closest("tr");d.hasClass("k-collapse")?b.collapseGroup(e):b.expandGroup(e),c.preventDefault()})},_selectable:function(){var a=this,b,d,e=a.options.selectable;e&&(b=typeof e===D&&e.toLowerCase().indexOf("multiple")>-1,d=typeof e===D&&e.toLowerCase().indexOf("cell")>-1,a.selectable=new c.ui.Selectable(a.table,{filter:d?s:r,multiple:b,change:function(){a.trigger(u)}}),a.options.navigatable&&a.wrapper.keydown(function(c){if(c.keyCode===i.SPACEBAR){c.preventDefault();var e=a.current();e=d?e:e.parent(),b?c.ctrlKey?e.hasClass(y)&&(e.removeClass(y),e=null):a.selectable.clear():a.selectable.clear(),a.selectable.value(e)}}))},clearSelection:function(){var a=this;a.selectable.clear(),a.trigger(u)},select:function(b){var c=this,d=c.selectable;b=a(b);if(b.length)d.options.multiple||(d.clear(),b=b.first()),d.value(b);else return d.value()},current:function(a){var c=this,d=c._current;if(a===b||!a.length)return c._current;if(!d||d[0]!==a[0])a.addClass(w),d&&d.removeClass(w),c._current=a,c._scrollTo(a.parent()[0])},_scrollTo:function(a){if(!!a&&!!this.options.scrollable){var b=a.offsetTop,c=this.content[0],d=a.offsetHeight,e=c.scrollTop,f=c.clientHeight,g=b+d;c.scrollTop=e>b?b:g>e+f?g-f:e}},_navigatable:function(){var b=this,c=b.wrapper,d=b.table.addClass(x),e=n(b.current,b),f="."+x+" "+s,g=function(b){e(a(b.currentTarget)),b.type==z&&c.focus()};b.options.navigatable&&(c.bind({focus:function(){var a=b._current;a&&a.is(":visible")?a.addClass(w):e(b.table.find(t))},focusout:function(){b._current&&b._current.removeClass(w)},keydown:function(a){var c=a.keyCode,f=b.current(),g=b.dataSource,h=b.options.pageable,j=!1;i.UP===c?(e(f?f.parent().prevAll(r).first().children().eq(f.index()):d.find(t)),j=!0):i.DOWN===c?(e(f?f.parent().nextAll(r).first().children().eq(f.index()):d.find(t)),j=!0):i.LEFT===c?(e(f?f.prev(":not(.k-group-cell)"):d.find(t)),j=!0):i.RIGHT===c?(e(f?f.next():d.find(t)),j=!0):h&&i.PAGEDOWN==c?(b._current=null,g.page(g.page()+1),j=!0):h&&i.PAGEUP==c&&(b._current=null,g.page(g.page()-1),j=!0),j&&a.preventDefault()}}),c.delegate(f,a.browser.msie?z:"mousedown",g))},_wrapper:function(){var a=this,b=a.table,c=a.options.height||b.css(A),d=a.element;d.is("div")||(d=d.wrap("<div />").parent()),a.wrapper=d.addClass("k-grid k-widget").attr(B,o.max(b.attr(B)||0,0)),b.removeAttr(B),c&&c!=="0px"&&(a.wrapper.css(A,c),b.css(A,"auto"))},_tbody:function(){var b=this,c=b.table,d;d=c.find(">tbody"),d.length||(d=a("<tbody />").appendTo(c)),b.tbody=d},_scrollable:function(){var b=this,d,e,f=b.options,g=b.wrapper.innerHeight(),h=f.scrollable,i=c.support.scrollbar();h&&(d=b.wrapper.children().filter(".k-grid-header"),d[0]||(d=a('<div class="k-grid-header" />').insertBefore(b.table)),d.css("padding-right",h.virtual?i+1:i),e=a('<table cellspacing="0" />'),e.append(b.thead),d.empty().append(a('<div class="k-grid-header-wrap" />').append(e)),b.content=b.table.parent(),b.content.is(".k-virtual-scrollable-wrap")&&(b.content=b.content.parent()),b.content.is(".k-grid-content, .k-virtual-scrollable-wrap")||(b.content=b.table.wrap('<div class="k-grid-content" />').parent(),h!==!0&&h.virtual&&new E(b.content,{dataSource:b.dataSource,itemHeight:n(b._averageRowHeight,b)})),g-=d.outerHeight(),b.pager&&(g-=b.pager.element.outerHeight()),f.groupable&&(g-=a(".k-grouping-header").outerHeight()),b.content.height(g))},_averageRowHeight:function(){var a=this,b=a._rowHeight;a._rowHeight||(a._rowHeight=b=a.table.outerHeight()/a.table[0].rows.length,a._sum=b,a._measures=1,totalHeight=o.round(a.dataSource.total()*b));var c=a.table.outerHeight()/a.table[0].rows.length;b!==c&&(a._measures++,a._sum+=c,a._rowHeight=a._sum/a._measures);return b},_dataSource:function(){var a=this,c=a.options,d=c.dataSource;d=m(d)?{data:d}:d,j(d)&&(k(d,{table:a.table,fields:a.columns}),c.data&&(d.data=c.data),pageable=c.pageable,j(pageable)&&pageable.pageSize!==b&&(d.pageSize=pageable.pageSize)),a.dataSource=e.create(d).bind(u,n(a.refresh,a)).bind(p,n(a._requestStart,a)).bind(q,n(a._error,a))},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_pageable:function(){var b=this,d,e=b.options.pageable;e&&(d=b.wrapper.children("div.k-grid-pager"),d.length||(d=a('<div class="k-grid-pager"/>').appendTo(b.wrapper)),typeof e=="object"&&e instanceof c.ui.Pageable?b.pager=e:b.pager=new c.ui.Pageable(d,k({},e,{dataSource:b.dataSource})))},_sortable:function(){var a=this,b=a.options.sortable;b&&a.thead.find("th").kendoSortable(k({},b,{dataSource:a.dataSource}))},_columns:function(b){var c=this,d=c.table,e=d.find("col");b=b.length?b:l(d.find("th"),function(b,c){var b=a(b),d=b.data("field");d||(d=b.text().replace(/\s|[^A-z0-9]/g,""));return{field:d,template:b.data("template"),width:e.eq(c).css("width")}}),c.columns=l(b,function(a){a=typeof a===D?{field:a}:a;return k({encoded:!0},a)})},_tmpl:function(a,b){var d=this,e=k({},c.Template,d.options.templateSettings),f=e.paramName,g,h=d.columns.length,i,j=d.dataSource.options.schema.model,l={},m,o=0,p,q,r=d.dataSource.group().length;if(!a){a="<tr",b&&(a+=' class="k-alt"'),j&&(m=j.id,m&&(q=typeof m,a+=' data-id="#=',q===D?(e.useWithBlock||(a+=f+"."),a+=m):q===C&&(l["tmpl"+o]=m,a+="this.tmpl"+o+"("+f+")",o++),a+='#"')),a+=">",r>0&&(a+=F(r));for(g=0;g<h;g++)p=d.columns[g],i=p.template,q=typeof i,a+="<td>",q===C?(l["tmpl"+o]=i,a+="#=this.tmpl"+o+"("+f+")#",o++):q===D?a+=i:(a+=p.encoded?"${":"#=",e.useWithBlock||(a+=f+"."),a+=p.field,a+=p.encoded?"}":"#"),a+="</td>";a+="</tr>"}a=c.template(a,e);if(o>0)return n(a,l);return a},_templates:function(){var a=this,b=a.options;a.rowTemplate=a._tmpl(b.rowTemplate),a.altRowTemplate=a._tmpl(b.altRowTemplate||b.rowTemplate,!0)},_thead:function(){var b=this,c=b.columns,d,e,f="",g=b.table.find("thead"),h,i;g.length||(g=a("<thead/>").insertBefore(b.tbody)),h=b.table.find("tr").filter(":has(th)"),h.length||(h=g.children().first(),h.length||(h=a("<tr/>")));if(!h.children().length){for(d=0,e=c.length;d<e;d++)i=c[d],f+="<th data-field='"+i.field+"'>"+(i.title||i.field)+"</th>";h.html(f)}h.find("th").addClass("k-header"),b.options.scrollable||g.addClass("k-grid-header"),h.appendTo(g),b.thead=g,b._sortable(),b._scrollable(),b._updateCols()},_updateCols:function(){var b=this,d=b.thead.parent().add(b.table),e=d.find("colgroup"),f,g=l(b.columns,function(a){f=a.width;if(f&&parseInt(f)!=0)return c.format('<col style="width:{0}"/>',f);return"<col />"}),h=b.dataSource.group().length;e.length&&e.remove(),e=a("<colgroup/>").append(a(Array(h+1).join('<col class="k-group-col">')+g.join(""))),d.prepend(e)},_autoColumns:function(a){if(a){var b=this,c;for(c in a)b.columns.push({field:c});b._thead(),b._templates()}},_rowsHtml:function(a){var b=this,c="",d,e,f=b.rowTemplate,g=b.altRowTemplate;for(d=0,e=a.length;d<e;d++)d%2?c+=g(a[d]):c+=f(a[d]);return c},_groupRowHtml:function(a,b,c){var d=this,e="",f,g,h=a.items;e+='<tr class="k-grouping-row">'+F(c)+'<td colspan="'+b+'">'+'<p class="k-reset">'+'<a class="k-icon k-collapse" href="#"></a>'+a.field+": "+a.value+"</p></td></tr>";if(a.hasSubgroups)for(f=0,g=h.length;f<g;f++)e+=d._groupRowHtml(h[f],b-1,c+1);else e+=d._rowsHtml(h);return e},collapseGroup:function(b){b=a(b).find(".k-icon").addClass("k-expand").removeClass("k-collapse").end();var c=b.find(".k-group-cell").length;b.nextUntil(function(){return a(".k-group-cell",this).length<=c}).hide()},expandGroup:function(b){b=a(b).find(".k-icon").addClass("k-collapse").removeClass("k-expand").end();var c=this,d=b.find(".k-group-cell").length;b.nextAll("tr").each(function(){var b=a(this),e=b.find(".k-group-cell").length;if(e<=d)return!1;e==d+1&&(b.show(),b.hasClass("k-grouping-row")&&b.find(".k-icon").hasClass("k-collapse")&&c.expandGroup(b))})},_updateHeader:function(b){var c=this,d=c.thead.find("th.k-group-cell"),e=d.length;b>e?a(Array(b-e+1).join('<th class="k-group-cell k-header">&nbsp;</th>')).prependTo(c.thead.find("tr")):b<e&&(e=e-b,a(a.grep(d,function(a,b){return e>b})).remove())},_firstDataItem:function(a,b){a&&b&&(a.hasSubgroups?a=this._firstDataItem(a.items[0],b):a=a.items[0]);return a},_progress:function(a){var b=this,d=b.element.is("table")?b.element.parent():b.content&&b.content.length?b.content:b.element;c.ui.progress(d,a)},refresh:function(){var b=this,c,d,e="",f=b.dataSource.view(),h,i,j=(b.dataSource.group()||[]).length,k=j+b.columns.length;b._progress(!1),b.columns.length||(b._autoColumns(b._firstDataItem(f[0],j)),k=j+b.columns.length),b._group=j>0||b._group,b._group&&(b._templates(),b._updateCols(),b._updateHeader(j),b._group=j>0);if(j>0)for(d=0,c=f.length;d<c;d++)e+=b._groupRowHtml(f[d],k,0);else e+=b._rowsHtml(f);g?b.tbody[0].innerHTML=e:(i=document.createElement("div"),i.innerHTML="<table><tbody>"+e+"</tbody></table>",h=i.firstChild.firstChild,b.table[0].replaceChild(h,b.tbody[0]),b.tbody=a(h)),b.trigger(v)}});d.plugin("Grid",G),d.plugin("VirtualScrollable",E)})(jQuery)