(function(a,b){var c=window.kendo,d=c.ui.Component,e=a.proxy,f="Drag a column header and drop it here to group by that column",g=c.template('<div class="k-group-indicator" data-field="${data.field}" data-dir="${data.dir || "asc"}"><a href="\\#" class="k-link"><span class="k-icon k-arrow-${(data.dir || "asc") == "asc" ? "up" : "down"}-small">(sorted ${(data.dir || "asc") == "asc" ? "ascending": "descending"})</span>${data.field}</a><a class="k-button k-button-icon k-button-bare"><span class="k-icon k-group-delete"></span></a></div>',{useWithBlock:!1}),h=function(b){return a('<div class="k-header k-drag-clue" />').html(b.data("field")).prepend('<span class="k-icon k-drag-status k-denied" />')},i=a('<div class="k-grouping-dropclue"/>'),j=d.extend({init:function(b,f){var g=this,j,k=c.guid(),l=e(g._intializePositions,g),m=g._dropCuePositions=[];d.fn.init.call(g,b,f),j=g.groupContainer=a(g.options.groupContainer,g.element).kendoDropTarget({group:k,dragenter:function(a){a.draggable.hint.find(".k-drag-status").removeClass("k-denied").addClass("k-add"),i.css({top:3,left:0}).appendTo(j)},dragleave:function(a){a.draggable.hint.find(".k-drag-status").removeClass("k-add").addClass("k-denied"),i.remove()}}).kendoDraggable({filter:"div.k-group-indicator",hint:h,group:k,dragend:function(a){g._dragEnd(this,a)},dragstart:function(a){var b=a.currentTarget,c=parseInt(b.css("marginLeft")),d=b.position().left-c;l(),i.css({top:3,left:d}).appendTo(j),this.hint.find(".k-drag-status").removeClass("k-denied").addClass("k-add")},drag:e(g._drag,g)}).delegate(".k-button","click",function(b){b.preventDefault(),g._removeIndicator(a(this).parent())}).delegate(".k-link","click",function(b){var c=a(this).parent(),d=g.buildIndicator(c.data("field"),c.data("dir")=="asc"?"desc":"asc");c.before(d).remove(),g._change(),b.preventDefault()}),g.element.kendoDraggable({filter:g.options.filter,hint:h,group:k,dragend:function(a){g._dragEnd(this,a)},dragstart:function(a){var b,c,d,e=a.currentTarget.data("field");g.indicator(e)?a.preventDefault():(l(),m.length?(b=m[m.length-1].element,c=parseInt(b.css("marginRight")),d=b.position().left+b.outerWidth()+c):d=0,i.css({top:3,left:d}).appendTo(j),this.hint.find(".k-drag-status").removeClass("k-denied").addClass("k-add"))},drag:e(g._drag,g)}),g.dataSource=g.options.dataSource,g.dataSource&&g.dataSource.bind("change",function(){j.empty().append(a.map(this.group()||[],function(a){return g.buildIndicator(a.field,a.dir)}).join("")),g._invalidateGroupContainer()})},options:{filter:"th"},indicator:function(b){var c=a(".k-group-indicator",this.groupContainer);return a.grep(c,function(c){return a(c).data("field")===b})[0]},buildIndicator:function(a,b){return g({field:a,dir:b})},descriptors:function(){var b=a(".k-group-indicator",this.groupContainer);return a.map(b,function(b){b=a(b);return{field:b.data("field"),dir:b.data("dir")}})},_removeIndicator:function(a){var b=this;a.remove(),b._invalidateGroupContainer(),b._change()},_change:function(){var a=this;a.dataSource&&a.dataSource.group(a.descriptors())},_dropCuePosition:function(b){var c=this._dropCuePositions;if(!!i.is(":visible")&&c.length!=0){var d=c[c.length-1],e=d.right,f=parseInt(d.element.css("marginLeft")),g=parseInt(d.element.css("marginRight"));b>=e?b={left:d.element.position().left+d.element.outerWidth()+g,element:d.element,before:!1}:(b=a.grep(c,function(a){return a.left<=b&&b<=a.right})[0],b&&(b={left:b.element.position().left-f,element:b.element,before:!0}));return b}},_drag:function(a){var b=this._dropCuePosition(a.pageX);b&&i.css({left:b.left})},_canDrop:function(a,b,c){var d=a.next();return a[0]!==b[0]&&(!d[0]||b[0]!==d[0]||c>d.position().left)},_dragEnd:function(b,c){var d=this,e=c.currentTarget.data("field"),f=d.indicator(e),g=d._dropCuePositions,h=g[g.length-1],j;b.dropped?h?(j=d._dropCuePosition(i.offset().left+parseInt(h.element.css("marginLeft"))+parseInt(h.element.css("marginRight"))),d._canDrop(a(f),j.element,j.left)&&(j.before?j.element.before(f||d.buildIndicator(e)):j.element.after(f||d.buildIndicator(e)),d._change())):(d.groupContainer.append(d.buildIndicator(e)),d._change()):f&&d._removeIndicator(a(f)),i.remove(),g=[]},_intializePositions:function(){var b=this,c=a(".k-group-indicator",b.groupContainer),d;b._dropCuePositions=a.map(c,function(b){b=a(b),d=b.offset().left;return{left:d,right:d+b.outerWidth(),element:b}})},_invalidateGroupContainer:function(){var a=this.groupContainer;a.is(":empty")&&a.html(f)}});c.ui.plugin("Groupable",j)})(jQuery)