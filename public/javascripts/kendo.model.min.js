(function(a,b){function l(a,b){if(a===b)return!0;var c=e(a),d=e(b),f;if(c!==d)return!1;if(c==="date")return a.getTime()===b.getTime();if(c!=="object"&&c!=="array")return!1;for(f in a)if(!l(a[f],b[f]))return!1;return!0}var c=window.kendo,d=a.extend,e=a.type,f=c.getter,g=c.setter,h=c.accessor,i=a.each,j="change",k=c.Observable,m=k.extend({init:function(a){var e=this;k.fn.init.call(e),e._accessors={},e._modified=!1,e.data=a||{},e.pristine=d(!0,{},a),e.id()===b&&(e._isNew=!0,e.data.__id=c.guid())},_accessor:function(a){var b=this._accessors;return b[a]=b[a]||h(a)},get:function(a){return this._accessor(a).get(this.data)},set:function(a,b){var c=this,d,e={},f=!1,g;typeof a=="string"?e[a]=b:e=a;for(d in e)g=c._accessor(d),b=e[d],l(b,g.get(c.data))||(g.set(c.data,b),c._modified=f=!0);f&&c.trigger(j)},_accept:function(a){var b=this;b._isNew=!1,b._modified=!1,d(b.data,a),b.pristine=d(!0,{},b.data)},hasChanges:function(){return this._modified},isNew:function(){return this._isNew===!0},changes:function(){var a=null,b,c=this,d=c.data,e=c.pristine;for(b in d)b!=="__id"&&(c.isNew()||!l(e[b],d[b]))&&(a=a||{},a[b]=d[b]);return a}});m.define=function(c){var e,h=d({},c),i=h.id||"id",j,k;a.isFunction(i)?(k=i,j=i):(k=f(i),j=g(i)),i=function(a,c){var d;if(c===b){d=k(a);return d!==b?d:a.__id}j(a,c)},h.id=function(a){return i(this.data,a)},e=m.extend(h),e.id=i,h.fields&&(e.fields=h.fields);return e};var n=k.extend({init:function(a){var b=this;b.options=a=d({},b.options,a),b._reader=a.reader,b._data=a.data||[],b._destroyed=[],b._transport=a.transport,b._models={},b._map(),k.fn.init.call(b),b.bind([j],a)},options:{batch:!1,sendAllFields:!1,autoSync:!1},_map:function(){var a=this,b=a._data,c=a.options.model;a._idMap={};for(idx=0,length=b.length;idx<length;idx++)a._idMap[c.id(b[idx])]=idx},data:function(a){var b=this;a&&(b._data=a,b._models={},b._destroyed=[],b._map())},get:function(a){var b=this,c,d=b._models[a];d||(c=b._data[b._idMap[a]],c&&(d=b._models[a]=new b.options.model(c)));return d},add:function(a){var b=this,c;a instanceof m?c=a.data:(c=a,a=new b.options.model(a)),b._data.push(c),b._map(),b._models[a.id()]=a,b.options.autoSync&&b.sync();return a},remove:function(a){var b=this,c=a,d,e;a instanceof m?c=a.id():a=b.get(c),a&&(b._data.splice(b._idMap[c],1),b._map(),delete b._models[c],a.isNew()||b._destroyed.push(a),b.options.autoSync&&b.sync());return a},sync:function(){var b=this,c=[],d=[],e=[],f,g,h,i=b.options,k=i.sendAllFields,l,m=b._models;for(g in m)l=m[g],l.isNew()?c.push({model:l,data:l.changes()}):l.hasChanges()&&(f=k?l.data:l.changes(),i.model.id(f,l.id()),d.push({model:l,data:f}));for(g=0,h=b._destroyed.length;g<h;g++)l=b._destroyed[g],f=k?l.data:{},i.model.id(f,l.id()),e.push({model:l,data:f});a.when.apply(null,b._send({create:c,update:d,destroy:e})).then(function(){var a,c;for(a=0,c=arguments.length;a<c;a++)b._accept(arguments[a]);b.trigger(j)})},_accept:function(b){var c=this,d=b.models,e=b.response||{},f=0,g;e=c._reader.data(c._reader.parse(e)),a.isArray(e)||(e=[e]);if(b.type==="destroy")c._destroyed=[];else for(f=0,g=d.length;f<g;f++)d[f]._accept(e[f])},_promise:function(b,c,e){var f=this,g=f._transport;return a.Deferred(function(a){g[e].call(g,d({success:function(b){a.resolve({response:b,models:c,type:e})},error:a.reject},b))}).promise()},_send:function(b){var c=this,d=[],e="create,update,destroy".split(",");i(e,function(e,f){var g=b[f],h,i;if(c.options.batch)g.length&&d.push(c._promise({data:{models:a.map(g,function(a){return a.data})}},a.map(g,function(a){return a.model}),f));else for(h=0,i=g.length;h<i;h++)d.push(c._promise({data:g[h].data},[g[h].model],f))});return d}});c.data.Model=m,c.data.ModelSet=n})(jQuery)